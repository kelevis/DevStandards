# 错误码规范

## 错误码定义原则

### 唯一性原则

错误码的定义应保证唯一性，即同一个场景应能且只能对应到唯一的一个错误码，不应出现含义相同的两个不同错误码。

例如：已定义了“无此账号”，不应再定义“账号不存在”。

### 无歧义原则

错误码的定义应保证不会有歧义，即不应将多个场景的错误码定义到同一个错误码上。

例如：不应定义有以下这种错误码“余额不足/交易金额超限”。

### 细粒度原则

错误码的定义应尽可能向更细的粒度扩展，以确保能更加精确地反映实际场景。但由于场景变更、设计人员经验及成本原因，不太可能一开始就可以定义出最细粒度的错误码，因此还是会存在非最细粒度的错误码，但在使用中需尽量避免使用这类错误码。

例如：开始设计错误码时会有“累计金额超限”这种错误码，但随着后续发展可以细化为“转账日累计金额超过限额”、“转账月累计金额超过限额”这些更细化的错误码，这时候应将“累计金额超限”标识为汇总类错误码，后续应用尽量避免使用该错误码（但错误码仍保留以兼容旧系统）。



## 错误码组成

错误码统一为13位，组成为“3位系统标识+4位模块标识+5位数字错误码”，例如‘MPCESSx00000’说明如下：

- 系统标识：必填，大写字母，以信息科技部公布的系统清单中的标识为准，例如MPC（中台系统），不足3位的情况右补小写字母“x”
- 模块标识：选填，大写字母，不填的情况为4个小写字母“x”；填入的是系统内部的模块标识，以中台系统为例，模块标识‘ESSx’（加密服务系统），不足4位的情况右补小写字母“x”
- 错误码：必填，5位数字，统一管理的统一错误码；其中第1位为错误类型编码（0-成功类，1-业务失败类，2-系统失败类，3-结果未知类）

注：错误码在全行系统统一定义，系统标识、模块标识则根据实际产生错误的系统情况填入



## 错误码使用规范

接口（函数）调用方收到错误码后，应只取最后5位的错误码进行错误的判断和处理，如果需要区别明细的错误，则取完整的5位进行判断；如果无需区分明细的错误，则可仅取错误类型编码（第1位）进行判断和处理，错误类型编码的说明和处理原则如下：

**0-成功类：**处理成功，其中00000为通用的成功代码；但也可以通过序号来定义不同的成功状态，例如对一个转账并通知客户的接口，可以定义以下的不同成功状态错误码：“00001-转账成功并短信通知、00002-转账成功并邮件通知”。

**1-业务失败类**：从业务角度看的正常失败情况，例如余额不足、账户已被冻结等情况；业务失败类的错误一般不认为是系统异常。

**2-系统失败类：**从系统角度看明确的异常处理失败情况，例如网络连接失败、数据插入失败等情况；系统失败类的错误说明系统存在问题，应进行监控并及时人工介入处理。

**3-结果未知类：**无法预知实际处理的情况应返回该类错误码，例如接口调用超时（或者调用下游系统的接口超时）、处理过程中的连接被重置等；调用方遇到结果未知类错误不能按成功或失败的逻辑进行处理，而是应该建立机制（例如自动轮询或人工查询）获取实际的处理结果后，再进行对用的处理。



## 系统标识及模块标识应用规范

本规范的目标是通过错误码的系统标识和模块标识，可以直接定位到出问题的系统及模块，因此在错误码生成时应按照以下的规则进行处理：

（1）系统自身产生的错误，系统标识和模块标识应按本系统的实际标识填写；

（2）系统在调用其他接口（函数）时产生的错误，系统标识及模块标识应填写被调用方的实际标识；

（3）系统在调用其他接口（函数），被调用方有返回错误码的情况，如果系统本身无特殊需求进行屏蔽的话，应直接透传被调用方的错误码。

举例说明如下：

（1）接口调用关系为 A > B > C，每个环节都成功，对于B来说应直接透传C返回的错误码，即A收到的错误码为C00000；

（2）接口调用关系为 A > B > C，C处理失败，对于B来说应直接透传C返回的错误码，即A收到的错误码为C20001；

（3）接口调用关系为 A > B > C，B调C的接口时出现网络错误，对于B来说是C的服务存在问题，所以错误码的标识应该置C，即A收到的错误码为C20002；

（4）接口调用关系为 A > B > C，B自身处理失败（例如校验不通过），对于B来说是自身服务出现问题，所以错误码的标识应该自身，即A收到的错误码为B20002；

（5）接口调用关系为 A > B > C、D、E，每个环节都成功，由于B是调用C、D、E的汇集点，而不是透传点，因此返回的错误码系统标识使用B的标识，即A收到的错误码为B00000；

（6）接口调用关系为 A > B > C、D、E，C调用失败，则认为错误发生点是C，因此返回的错误码系统标识使用C的标识，即A收到的错误码为C20001。



## 不规范错误码的兼容要求

对于系统的开发（新增接口），应严格遵循本错误码规范执行，但在开发中若遇到与未完成错误码规范改造的系统对接的情况，应按照以下原则执行：

（1）系统自身向外部返回的错误码，必须严格遵循错误码规范执行，如果需要向上游返回下游的错误，则应对下游的错误码进行规范的转换；

（2）系统在进行下游错误码的转换时，必须梳理清楚下游的各种错误码含义，明确将这些错误码映射到4类错误分类中。由于梳理过程中不一定能完整梳理全部情况，建议该部分处理通过映射表方式处理，避免后续错误码调整需改造代码。进行映射一定要遵循一个原则，对于梳理结果中不存在的错误码，必须映射为39999这个未知结果的错误码，按照未知结果的情况进行处理。



## 错误码统一管理要求



由于错误码是全局统一的，因此不允许各个系统自行定义错误码，而是必须使用发布的标准错误码，如果所发布的错误码不能涵盖各个系统的应用需求，必须向服务治理小组申请新增错误码。

若检查发现新增接口有使用非标准错误码的情况，将由服务治理小组在部门中进行通报处罚。



## 常用错误码定义

详细的错误码定义可向服务治理小组获取，本章节列出固定的几个常用错误码定义：

| **错误码** | **汇总标志** | **错误描述** |
| ---------- | ------------ | ------------ |
| 00000      | N            | 成功         |
| 19999      | Y            | 其他业务失败 |
| 29999      | Y            | 其他系统失败 |
| 39999      | Y            | 其他未知结果 |

 




